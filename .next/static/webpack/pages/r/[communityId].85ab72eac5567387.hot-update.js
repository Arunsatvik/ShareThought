"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
self["webpackHotUpdate_N_E"]("pages/r/[communityId]",{

/***/ "./src/hooks/usePosts.tsx":
/*!********************************!*\
  !*** ./src/hooks/usePosts.tsx ***!
  \********************************/
/***/ (function(module, __webpack_exports__, __webpack_require__) {

eval(__webpack_require__.ts("__webpack_require__.r(__webpack_exports__);\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! react */ \"./node_modules/react/index.js\");\n/* harmony import */ var react__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(react__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var firebase_firestore__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! firebase/firestore */ \"./node_modules/firebase/firestore/dist/esm/index.esm.js\");\n/* harmony import */ var firebase_storage__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! firebase/storage */ \"./node_modules/firebase/storage/dist/esm/index.esm.js\");\n/* harmony import */ var react_firebase_hooks_auth__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! react-firebase-hooks/auth */ \"./node_modules/react-firebase-hooks/auth/dist/index.esm.js\");\n/* harmony import */ var recoil__WEBPACK_IMPORTED_MODULE_4__ = __webpack_require__(/*! recoil */ \"./node_modules/recoil/es/index.js\");\n/* harmony import */ var _atoms_authModalAtom__WEBPACK_IMPORTED_MODULE_5__ = __webpack_require__(/*! ../atoms/authModalAtom */ \"./src/atoms/authModalAtom.ts\");\n/* harmony import */ var _atoms_communitiesAtom__WEBPACK_IMPORTED_MODULE_6__ = __webpack_require__(/*! ../atoms/communitiesAtom */ \"./src/atoms/communitiesAtom.ts\");\n/* harmony import */ var _atoms_postsAtom__WEBPACK_IMPORTED_MODULE_7__ = __webpack_require__(/*! ../atoms/postsAtom */ \"./src/atoms/postsAtom.ts\");\n/* harmony import */ var _firebase_clientApp__WEBPACK_IMPORTED_MODULE_8__ = __webpack_require__(/*! ../firebase/clientApp */ \"./src/firebase/clientApp.ts\");\n/* harmony import */ var next_router__WEBPACK_IMPORTED_MODULE_9__ = __webpack_require__(/*! next/router */ \"./node_modules/next/router.js\");\n/* harmony import */ var next_router__WEBPACK_IMPORTED_MODULE_9___default = /*#__PURE__*/__webpack_require__.n(next_router__WEBPACK_IMPORTED_MODULE_9__);\nvar _s = $RefreshSig$();\n\n\n\n\n\n\n\n\n\n\nconst usePosts = (communityData)=>{\n    _s();\n    const [user, loadingUser] = (0,react_firebase_hooks_auth__WEBPACK_IMPORTED_MODULE_3__.useAuthState)(_firebase_clientApp__WEBPACK_IMPORTED_MODULE_8__.auth);\n    const [postStateValue, setPostStateValue] = (0,recoil__WEBPACK_IMPORTED_MODULE_4__.useRecoilState)(_atoms_postsAtom__WEBPACK_IMPORTED_MODULE_7__.postState);\n    const setAuthModalState = (0,recoil__WEBPACK_IMPORTED_MODULE_4__.useSetRecoilState)(_atoms_authModalAtom__WEBPACK_IMPORTED_MODULE_5__.authModalState);\n    const [loading, setLoading] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(false);\n    const [error, setError] = (0,react__WEBPACK_IMPORTED_MODULE_0__.useState)(\"\");\n    const router = (0,next_router__WEBPACK_IMPORTED_MODULE_9__.useRouter)();\n    const communityStateValue = (0,recoil__WEBPACK_IMPORTED_MODULE_4__.useRecoilValue)(_atoms_communitiesAtom__WEBPACK_IMPORTED_MODULE_6__.communityState);\n    const onSelectPost = (post, postIdx)=>{\n        console.log(\"HERE IS STUFF\", post, postIdx);\n        setPostStateValue((prev)=>({\n                ...prev,\n                selectedPost: {\n                    ...post,\n                    postIdx\n                }\n            }));\n        router.push(\"/r/\".concat(post.communityId, \"/comments/\").concat(post.id));\n    };\n    const onVote = async (event, post, vote, communityId)=>{\n        var _user;\n        event.stopPropagation();\n        if (!((_user = user) === null || _user === void 0 ? void 0 : _user.uid)) {\n            setAuthModalState({\n                open: true,\n                view: \"login\"\n            });\n            return;\n        }\n        const { voteStatus } = post;\n        // const existingVote = post.currentUserVoteStatus;\n        const existingVote = postStateValue.postVotes.find((vote)=>vote.postId === post.id);\n        // is this an upvote or a downvote?\n        // has this user voted on this post already? was it up or down?\n        try {\n            let voteChange = vote;\n            const batch = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.writeBatch)(_firebase_clientApp__WEBPACK_IMPORTED_MODULE_8__.firestore);\n            const updatedPost = {\n                ...post\n            };\n            const updatedPosts = [\n                ...postStateValue.posts\n            ];\n            let updatedPostVotes = [\n                ...postStateValue.postVotes\n            ];\n            // New vote\n            if (!existingVote) {\n                const postVoteRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_clientApp__WEBPACK_IMPORTED_MODULE_8__.firestore, \"users\", \"\".concat(user.uid, \"/postVotes\")));\n                const newVote = {\n                    id: postVoteRef.id,\n                    postId: post.id,\n                    communityId,\n                    voteValue: vote\n                };\n                console.log(\"NEW VOTE!!!\", newVote);\n                // APRIL 25 - DON'T THINK WE NEED THIS\n                // newVote.id = postVoteRef.id;\n                batch.set(postVoteRef, newVote);\n                updatedPost.voteStatus = voteStatus + vote;\n                updatedPostVotes = [\n                    ...updatedPostVotes,\n                    newVote\n                ];\n            } else {\n                // Used for both possible cases of batch writes\n                const postVoteRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_clientApp__WEBPACK_IMPORTED_MODULE_8__.firestore, \"users\", \"\".concat(user.uid, \"/postVotes/\").concat(existingVote.id));\n                // Removing vote\n                if (existingVote.voteValue === vote) {\n                    voteChange *= -1;\n                    updatedPost.voteStatus = voteStatus - vote;\n                    updatedPostVotes = updatedPostVotes.filter((vote)=>vote.id !== existingVote.id);\n                    batch.delete(postVoteRef);\n                } else {\n                    voteChange = 2 * vote;\n                    updatedPost.voteStatus = voteStatus + 2 * vote;\n                    const voteIdx = postStateValue.postVotes.findIndex((vote)=>vote.id === existingVote.id);\n                    // console.log(\"HERE IS VOTE INDEX\", voteIdx);\n                    // Vote was found - findIndex returns -1 if not found\n                    if (voteIdx !== -1) {\n                        updatedPostVotes[voteIdx] = {\n                            ...existingVote,\n                            voteValue: vote\n                        };\n                    }\n                    batch.update(postVoteRef, {\n                        voteValue: vote\n                    });\n                }\n            }\n            let updatedState = {\n                ...postStateValue,\n                postVotes: updatedPostVotes\n            };\n            const postIdx = postStateValue.posts.findIndex((item)=>item.id === post.id);\n            // if (postIdx !== undefined) {\n            updatedPosts[postIdx] = updatedPost;\n            updatedState = {\n                ...updatedState,\n                posts: updatedPosts\n            };\n            // }\n            /**\n       * Optimistically update the UI\n       * Used for single page view [pid]\n       * since we don't have real-time listener there\n       */ if (updatedState.selectedPost) {\n                updatedState = {\n                    ...updatedState,\n                    selectedPost: updatedPost\n                };\n            }\n            // Optimistically update the UI\n            setPostStateValue(updatedState);\n            // Update database\n            const postRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_clientApp__WEBPACK_IMPORTED_MODULE_8__.firestore, \"posts\", post.id);\n            batch.update(postRef, {\n                voteStatus: voteStatus + voteChange\n            });\n            await batch.commit();\n        } catch (error) {\n            console.log(\"onVote error\", error);\n        }\n    };\n    const onDeletePost = async (post)=>{\n        console.log(\"DELETING POST: \", post.id);\n        try {\n            // if post has an image url, delete it from storage\n            if (post.imageURL) {\n                const imageRef = (0,firebase_storage__WEBPACK_IMPORTED_MODULE_2__.ref)(_firebase_clientApp__WEBPACK_IMPORTED_MODULE_8__.storage, \"posts/\".concat(post.id, \"/image\"));\n                await (0,firebase_storage__WEBPACK_IMPORTED_MODULE_2__.deleteObject)(imageRef);\n            }\n            // delete post from posts collection\n            const postDocRef = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.doc)(_firebase_clientApp__WEBPACK_IMPORTED_MODULE_8__.firestore, \"posts\", post.id);\n            await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.deleteDoc)(postDocRef);\n            // Update post state\n            setPostStateValue((prev)=>({\n                    ...prev,\n                    posts: prev.posts.filter((item)=>item.id !== post.id)\n                }));\n            /**\n       * Cloud Function will trigger on post delete\n       * to delete all comments with postId === post.id\n       */ return true;\n        } catch (error) {\n            console.log(\"THERE WAS AN ERROR\", error);\n            return false;\n        }\n    };\n    const getCommunityPostVotes = async (communityId)=>{\n        var _user;\n        const postVotesQuery = (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.query)((0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.collection)(_firebase_clientApp__WEBPACK_IMPORTED_MODULE_8__.firestore, \"users/\".concat((_user = user) === null || _user === void 0 ? void 0 : _user.uid, \"/postVotes\")), (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.where)(\"communityId\", \"==\", communityId));\n        const postVoteDocs = await (0,firebase_firestore__WEBPACK_IMPORTED_MODULE_1__.getDocs)(postVotesQuery);\n        const postVotes = postVoteDocs.docs.map((doc)=>({\n                id: doc.id,\n                ...doc.data()\n            }));\n        setPostStateValue((prev)=>({\n                ...prev,\n                postVotes: postVotes\n            }));\n    // const unsubscribe = onSnapshot(postVotesQuery, (querySnapshot) => {\n    //   const postVotes = querySnapshot.docs.map((postVote) => ({\n    //     id: postVote.id,\n    //     ...postVote.data(),\n    //   }));\n    // });\n    // return () => unsubscribe();\n    };\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        var _user;\n        if (!((_user = user) === null || _user === void 0 ? void 0 : _user.uid) || !communityStateValue.currentCommunity) return;\n        getCommunityPostVotes(communityStateValue.currentCommunity.id);\n    }, [\n        user,\n        communityStateValue.currentCommunity\n    ]);\n    /**\n   * DO THIS INITIALLY FOR POST VOTES\n   */ // useEffect(() => {\n    //   if (!user?.uid || !communityData) return;\n    //   const postVotesQuery = query(\n    //     collection(firestore, `users/${user?.uid}/postVotes`),\n    //     where(\"communityId\", \"==\", communityData?.id)\n    //   );\n    //   const unsubscribe = onSnapshot(postVotesQuery, (querySnapshot) => {\n    //     const postVotes = querySnapshot.docs.map((postVote) => ({\n    //       id: postVote.id,\n    //       ...postVote.data(),\n    //     }));\n    //     setPostStateValue((prev) => ({\n    //       ...prev,\n    //       postVotes: postVotes as PostVote[],\n    //     }));\n    //   });\n    //   return () => unsubscribe();\n    // }, [user, communityData]);\n    (0,react__WEBPACK_IMPORTED_MODULE_0__.useEffect)(()=>{\n        var _user;\n        // Logout or no authenticated user\n        if (!((_user = user) === null || _user === void 0 ? void 0 : _user.uid) && !loadingUser) {\n            setPostStateValue((prev)=>({\n                    ...prev,\n                    postVotes: []\n                }));\n            return;\n        }\n    }, [\n        user,\n        loadingUser\n    ]);\n    return {\n        postStateValue,\n        setPostStateValue,\n        onSelectPost,\n        onDeletePost,\n        loading,\n        setLoading,\n        onVote,\n        error\n    };\n};\n_s(usePosts, \"cvq66CudPqQFxbDzCuXKCqz55oI=\", false, function() {\n    return [\n        react_firebase_hooks_auth__WEBPACK_IMPORTED_MODULE_3__.useAuthState,\n        recoil__WEBPACK_IMPORTED_MODULE_4__.useRecoilState,\n        recoil__WEBPACK_IMPORTED_MODULE_4__.useSetRecoilState,\n        next_router__WEBPACK_IMPORTED_MODULE_9__.useRouter,\n        recoil__WEBPACK_IMPORTED_MODULE_4__.useRecoilValue\n    ];\n});\n/* harmony default export */ __webpack_exports__[\"default\"] = (usePosts);\n\n\n;\n    // Wrapped in an IIFE to avoid polluting the global scope\n    ;\n    (function () {\n        var _a, _b;\n        // Legacy CSS implementations will `eval` browser code in a Node.js context\n        // to extract CSS. For backwards compatibility, we need to check we're in a\n        // browser context before continuing.\n        if (typeof self !== 'undefined' &&\n            // AMP / No-JS mode does not inject these helpers:\n            '$RefreshHelpers$' in self) {\n            // @ts-ignore __webpack_module__ is global\n            var currentExports = module.exports;\n            // @ts-ignore __webpack_module__ is global\n            var prevExports = (_b = (_a = module.hot.data) === null || _a === void 0 ? void 0 : _a.prevExports) !== null && _b !== void 0 ? _b : null;\n            // This cannot happen in MainTemplate because the exports mismatch between\n            // templating and execution.\n            self.$RefreshHelpers$.registerExportsForReactRefresh(currentExports, module.id);\n            // A module can be accepted automatically based on its exports, e.g. when\n            // it is a Refresh Boundary.\n            if (self.$RefreshHelpers$.isReactRefreshBoundary(currentExports)) {\n                // Save the previous exports on update so we can compare the boundary\n                // signatures.\n                module.hot.dispose(function (data) {\n                    data.prevExports = currentExports;\n                });\n                // Unconditionally accept an update to this module, we'll check if it's\n                // still a Refresh Boundary later.\n                // @ts-ignore importMeta is replaced in the loader\n                module.hot.accept();\n                // This field is set when the previous version of this module was a\n                // Refresh Boundary, letting us know we need to check for invalidation or\n                // enqueue an update.\n                if (prevExports !== null) {\n                    // A boundary can become ineligible if its exports are incompatible\n                    // with the previous exports.\n                    //\n                    // For example, if you add/remove/change exports, we'll want to\n                    // re-execute the importing modules, and force those components to\n                    // re-render. Similarly, if you convert a class component to a\n                    // function, we want to invalidate the boundary.\n                    if (self.$RefreshHelpers$.shouldInvalidateReactRefreshBoundary(prevExports, currentExports)) {\n                        module.hot.invalidate();\n                    }\n                    else {\n                        self.$RefreshHelpers$.scheduleUpdate();\n                    }\n                }\n            }\n            else {\n                // Since we just executed the code for the module, it's possible that the\n                // new exports made it ineligible for being a boundary.\n                // We only care about the case when we were _previously_ a boundary,\n                // because we already accepted this update (accidental side effect).\n                var isNoLongerABoundary = prevExports !== null;\n                if (isNoLongerABoundary) {\n                    module.hot.invalidate();\n                }\n            }\n        }\n    })();\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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Q0FBQ2EsT0FBVTtvQkFDM0IsR0FBR0EsSUFBSTtvQkFDUGMsV0FBVyxFQUFFO2dCQUNmO1lBQ0E7UUFDRjtJQUNGLEdBQUc7UUFBQzlCO1FBQU1DO0tBQVk7SUFFdEIsT0FBTztRQUNMQztRQUNBQztRQUNBUTtRQUNBeUM7UUFDQS9DO1FBQ0FDO1FBQ0FlO1FBQ0FkO0lBQ0Y7QUFDRjtHQTNRTVQ7O1FBQ3dCWCxtRUFBWUE7UUFDSUMsa0RBQWNBO1FBQ2hDRSxxREFBaUJBO1FBRzVCTyxrREFBU0E7UUFDSVIsa0RBQWNBOzs7QUFzUTVDLCtEQUFlUyxRQUFRQSxFQUFDIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vX05fRS8uL3NyYy9ob29rcy91c2VQb3N0cy50c3g/MTc5MCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gXCJyZWFjdFwiO1xuaW1wb3J0IHtcbiAgY29sbGVjdGlvbixcbiAgZGVsZXRlRG9jLFxuICBkb2MsXG4gIGdldERvY3MsXG4gIG9uU25hcHNob3QsXG4gIHF1ZXJ5LFxuICB3aGVyZSxcbiAgd3JpdGVCYXRjaCxcbn0gZnJvbSBcImZpcmViYXNlL2ZpcmVzdG9yZVwiO1xuaW1wb3J0IHsgZGVsZXRlT2JqZWN0LCByZWYgfSBmcm9tIFwiZmlyZWJhc2Uvc3RvcmFnZVwiO1xuaW1wb3J0IHsgdXNlQXV0aFN0YXRlIH0gZnJvbSBcInJlYWN0LWZpcmViYXNlLWhvb2tzL2F1dGhcIjtcbmltcG9ydCB7IHVzZVJlY29pbFN0YXRlLCB1c2VSZWNvaWxWYWx1ZSwgdXNlU2V0UmVjb2lsU3RhdGUgfSBmcm9tIFwicmVjb2lsXCI7XG5pbXBvcnQgeyBhdXRoTW9kYWxTdGF0ZSB9IGZyb20gXCIuLi9hdG9tcy9hdXRoTW9kYWxBdG9tXCI7XG5pbXBvcnQgeyBDb21tdW5pdHksIGNvbW11bml0eVN0YXRlIH0gZnJvbSBcIi4uL2F0b21zL2NvbW11bml0aWVzQXRvbVwiO1xuaW1wb3J0IHsgUG9zdCwgcG9zdFN0YXRlLCBQb3N0Vm90ZSB9IGZyb20gXCIuLi9hdG9tcy9wb3N0c0F0b21cIjtcbmltcG9ydCB7IGF1dGgsIGZpcmVzdG9yZSwgc3RvcmFnZSB9IGZyb20gXCIuLi9maXJlYmFzZS9jbGllbnRBcHBcIjtcbmltcG9ydCB7IHVzZVJvdXRlciB9IGZyb20gXCJuZXh0L3JvdXRlclwiO1xuXG5jb25zdCB1c2VQb3N0cyA9IChjb21tdW5pdHlEYXRhPzogQ29tbXVuaXR5KSA9PiB7XG4gIGNvbnN0IFt1c2VyLCBsb2FkaW5nVXNlcl0gPSB1c2VBdXRoU3RhdGUoYXV0aCk7XG4gIGNvbnN0IFtwb3N0U3RhdGVWYWx1ZSwgc2V0UG9zdFN0YXRlVmFsdWVdID0gdXNlUmVjb2lsU3RhdGUocG9zdFN0YXRlKTtcbiAgY29uc3Qgc2V0QXV0aE1vZGFsU3RhdGUgPSB1c2VTZXRSZWNvaWxTdGF0ZShhdXRoTW9kYWxTdGF0ZSk7XG4gIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKTtcbiAgY29uc3QgW2Vycm9yLCBzZXRFcnJvcl0gPSB1c2VTdGF0ZShcIlwiKTtcbiAgY29uc3Qgcm91dGVyID0gdXNlUm91dGVyKCk7XG4gIGNvbnN0IGNvbW11bml0eVN0YXRlVmFsdWUgPSB1c2VSZWNvaWxWYWx1ZShjb21tdW5pdHlTdGF0ZSk7XG5cbiAgY29uc3Qgb25TZWxlY3RQb3N0ID0gKHBvc3Q6IFBvc3QsIHBvc3RJZHg6IG51bWJlcikgPT4ge1xuICAgIGNvbnNvbGUubG9nKFwiSEVSRSBJUyBTVFVGRlwiLCBwb3N0LCBwb3N0SWR4KTtcblxuICAgIHNldFBvc3RTdGF0ZVZhbHVlKChwcmV2KSA9PiAoe1xuICAgICAgLi4ucHJldixcbiAgICAgIHNlbGVjdGVkUG9zdDogeyAuLi5wb3N0LCBwb3N0SWR4IH0sXG4gICAgfSkpO1xuICAgIHJvdXRlci5wdXNoKGAvci8ke3Bvc3QuY29tbXVuaXR5SWR9L2NvbW1lbnRzLyR7cG9zdC5pZH1gKTtcbiAgfTtcblxuICBjb25zdCBvblZvdGUgPSBhc3luYyAoXG4gICAgZXZlbnQ6IFJlYWN0Lk1vdXNlRXZlbnQ8U1ZHRWxlbWVudCwgTW91c2VFdmVudD4sXG4gICAgcG9zdDogUG9zdCxcbiAgICB2b3RlOiBudW1iZXIsXG4gICAgY29tbXVuaXR5SWQ6IHN0cmluZ1xuICAgIC8vIHBvc3RJZHg/OiBudW1iZXJcbiAgKSA9PiB7XG4gICAgZXZlbnQuc3RvcFByb3BhZ2F0aW9uKCk7XG4gICAgaWYgKCF1c2VyPy51aWQpIHtcbiAgICAgIHNldEF1dGhNb2RhbFN0YXRlKHsgb3BlbjogdHJ1ZSwgdmlldzogXCJsb2dpblwiIH0pO1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIGNvbnN0IHsgdm90ZVN0YXR1cyB9ID0gcG9zdDtcbiAgICAvLyBjb25zdCBleGlzdGluZ1ZvdGUgPSBwb3N0LmN1cnJlbnRVc2VyVm90ZVN0YXR1cztcbiAgICBjb25zdCBleGlzdGluZ1ZvdGUgPSBwb3N0U3RhdGVWYWx1ZS5wb3N0Vm90ZXMuZmluZChcbiAgICAgICh2b3RlKSA9PiB2b3RlLnBvc3RJZCA9PT0gcG9zdC5pZFxuICAgICk7XG5cbiAgICAvLyBpcyB0aGlzIGFuIHVwdm90ZSBvciBhIGRvd252b3RlP1xuICAgIC8vIGhhcyB0aGlzIHVzZXIgdm90ZWQgb24gdGhpcyBwb3N0IGFscmVhZHk/IHdhcyBpdCB1cCBvciBkb3duP1xuXG4gICAgdHJ5IHtcbiAgICAgIGxldCB2b3RlQ2hhbmdlID0gdm90ZTtcbiAgICAgIGNvbnN0IGJhdGNoID0gd3JpdGVCYXRjaChmaXJlc3RvcmUpO1xuXG4gICAgICBjb25zdCB1cGRhdGVkUG9zdCA9IHsgLi4ucG9zdCB9O1xuICAgICAgY29uc3QgdXBkYXRlZFBvc3RzID0gWy4uLnBvc3RTdGF0ZVZhbHVlLnBvc3RzXTtcbiAgICAgIGxldCB1cGRhdGVkUG9zdFZvdGVzID0gWy4uLnBvc3RTdGF0ZVZhbHVlLnBvc3RWb3Rlc107XG5cbiAgICAgIC8vIE5ldyB2b3RlXG4gICAgICBpZiAoIWV4aXN0aW5nVm90ZSkge1xuICAgICAgICBjb25zdCBwb3N0Vm90ZVJlZiA9IGRvYyhcbiAgICAgICAgICBjb2xsZWN0aW9uKGZpcmVzdG9yZSwgXCJ1c2Vyc1wiLCBgJHt1c2VyLnVpZH0vcG9zdFZvdGVzYClcbiAgICAgICAgKTtcblxuICAgICAgICBjb25zdCBuZXdWb3RlOiBQb3N0Vm90ZSA9IHtcbiAgICAgICAgICBpZDogcG9zdFZvdGVSZWYuaWQsXG4gICAgICAgICAgcG9zdElkOiBwb3N0LmlkLFxuICAgICAgICAgIGNvbW11bml0eUlkLFxuICAgICAgICAgIHZvdGVWYWx1ZTogdm90ZSxcbiAgICAgICAgfTtcblxuICAgICAgICBjb25zb2xlLmxvZyhcIk5FVyBWT1RFISEhXCIsIG5ld1ZvdGUpO1xuXG4gICAgICAgIC8vIEFQUklMIDI1IC0gRE9OJ1QgVEhJTksgV0UgTkVFRCBUSElTXG4gICAgICAgIC8vIG5ld1ZvdGUuaWQgPSBwb3N0Vm90ZVJlZi5pZDtcblxuICAgICAgICBiYXRjaC5zZXQocG9zdFZvdGVSZWYsIG5ld1ZvdGUpO1xuXG4gICAgICAgIHVwZGF0ZWRQb3N0LnZvdGVTdGF0dXMgPSB2b3RlU3RhdHVzICsgdm90ZTtcbiAgICAgICAgdXBkYXRlZFBvc3RWb3RlcyA9IFsuLi51cGRhdGVkUG9zdFZvdGVzLCBuZXdWb3RlXTtcbiAgICAgIH1cbiAgICAgIC8vIFJlbW92aW5nIGV4aXN0aW5nIHZvdGVcbiAgICAgIGVsc2Uge1xuICAgICAgICAvLyBVc2VkIGZvciBib3RoIHBvc3NpYmxlIGNhc2VzIG9mIGJhdGNoIHdyaXRlc1xuICAgICAgICBjb25zdCBwb3N0Vm90ZVJlZiA9IGRvYyhcbiAgICAgICAgICBmaXJlc3RvcmUsXG4gICAgICAgICAgXCJ1c2Vyc1wiLFxuICAgICAgICAgIGAke3VzZXIudWlkfS9wb3N0Vm90ZXMvJHtleGlzdGluZ1ZvdGUuaWR9YFxuICAgICAgICApO1xuXG4gICAgICAgIC8vIFJlbW92aW5nIHZvdGVcbiAgICAgICAgaWYgKGV4aXN0aW5nVm90ZS52b3RlVmFsdWUgPT09IHZvdGUpIHtcbiAgICAgICAgICB2b3RlQ2hhbmdlICo9IC0xO1xuICAgICAgICAgIHVwZGF0ZWRQb3N0LnZvdGVTdGF0dXMgPSB2b3RlU3RhdHVzIC0gdm90ZTtcbiAgICAgICAgICB1cGRhdGVkUG9zdFZvdGVzID0gdXBkYXRlZFBvc3RWb3Rlcy5maWx0ZXIoXG4gICAgICAgICAgICAodm90ZSkgPT4gdm90ZS5pZCAhPT0gZXhpc3RpbmdWb3RlLmlkXG4gICAgICAgICAgKTtcbiAgICAgICAgICBiYXRjaC5kZWxldGUocG9zdFZvdGVSZWYpO1xuICAgICAgICB9XG4gICAgICAgIC8vIENoYW5naW5nIHZvdGVcbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgdm90ZUNoYW5nZSA9IDIgKiB2b3RlO1xuICAgICAgICAgIHVwZGF0ZWRQb3N0LnZvdGVTdGF0dXMgPSB2b3RlU3RhdHVzICsgMiAqIHZvdGU7XG4gICAgICAgICAgY29uc3Qgdm90ZUlkeCA9IHBvc3RTdGF0ZVZhbHVlLnBvc3RWb3Rlcy5maW5kSW5kZXgoXG4gICAgICAgICAgICAodm90ZSkgPT4gdm90ZS5pZCA9PT0gZXhpc3RpbmdWb3RlLmlkXG4gICAgICAgICAgKTtcbiAgICAgICAgICAvLyBjb25zb2xlLmxvZyhcIkhFUkUgSVMgVk9URSBJTkRFWFwiLCB2b3RlSWR4KTtcblxuICAgICAgICAgIC8vIFZvdGUgd2FzIGZvdW5kIC0gZmluZEluZGV4IHJldHVybnMgLTEgaWYgbm90IGZvdW5kXG4gICAgICAgICAgaWYgKHZvdGVJZHggIT09IC0xKSB7XG4gICAgICAgICAgICB1cGRhdGVkUG9zdFZvdGVzW3ZvdGVJZHhdID0ge1xuICAgICAgICAgICAgICAuLi5leGlzdGluZ1ZvdGUsXG4gICAgICAgICAgICAgIHZvdGVWYWx1ZTogdm90ZSxcbiAgICAgICAgICAgIH07XG4gICAgICAgICAgfVxuICAgICAgICAgIGJhdGNoLnVwZGF0ZShwb3N0Vm90ZVJlZiwge1xuICAgICAgICAgICAgdm90ZVZhbHVlOiB2b3RlLFxuICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICB9XG5cbiAgICAgIGxldCB1cGRhdGVkU3RhdGUgPSB7IC4uLnBvc3RTdGF0ZVZhbHVlLCBwb3N0Vm90ZXM6IHVwZGF0ZWRQb3N0Vm90ZXMgfTtcblxuICAgICAgY29uc3QgcG9zdElkeCA9IHBvc3RTdGF0ZVZhbHVlLnBvc3RzLmZpbmRJbmRleChcbiAgICAgICAgKGl0ZW0pID0+IGl0ZW0uaWQgPT09IHBvc3QuaWRcbiAgICAgICk7XG5cbiAgICAgIC8vIGlmIChwb3N0SWR4ICE9PSB1bmRlZmluZWQpIHtcbiAgICAgIHVwZGF0ZWRQb3N0c1twb3N0SWR4IV0gPSB1cGRhdGVkUG9zdDtcbiAgICAgIHVwZGF0ZWRTdGF0ZSA9IHtcbiAgICAgICAgLi4udXBkYXRlZFN0YXRlLFxuICAgICAgICBwb3N0czogdXBkYXRlZFBvc3RzLFxuICAgICAgICAvLyBwb3N0c0NhY2hlOiB7XG4gICAgICAgIC8vICAgLi4udXBkYXRlZFN0YXRlLnBvc3RzQ2FjaGUsXG4gICAgICAgIC8vICAgW2NvbW11bml0eUlkXTogdXBkYXRlZFBvc3RzLFxuICAgICAgICAvLyB9LFxuICAgICAgfTtcbiAgICAgIC8vIH1cblxuICAgICAgLyoqXG4gICAgICAgKiBPcHRpbWlzdGljYWxseSB1cGRhdGUgdGhlIFVJXG4gICAgICAgKiBVc2VkIGZvciBzaW5nbGUgcGFnZSB2aWV3IFtwaWRdXG4gICAgICAgKiBzaW5jZSB3ZSBkb24ndCBoYXZlIHJlYWwtdGltZSBsaXN0ZW5lciB0aGVyZVxuICAgICAgICovXG4gICAgICBpZiAodXBkYXRlZFN0YXRlLnNlbGVjdGVkUG9zdCkge1xuICAgICAgICB1cGRhdGVkU3RhdGUgPSB7XG4gICAgICAgICAgLi4udXBkYXRlZFN0YXRlLFxuICAgICAgICAgIHNlbGVjdGVkUG9zdDogdXBkYXRlZFBvc3QsXG4gICAgICAgIH07XG4gICAgICB9XG5cbiAgICAgIC8vIE9wdGltaXN0aWNhbGx5IHVwZGF0ZSB0aGUgVUlcbiAgICAgIHNldFBvc3RTdGF0ZVZhbHVlKHVwZGF0ZWRTdGF0ZSk7XG5cbiAgICAgIC8vIFVwZGF0ZSBkYXRhYmFzZVxuICAgICAgY29uc3QgcG9zdFJlZiA9IGRvYyhmaXJlc3RvcmUsIFwicG9zdHNcIiwgcG9zdC5pZCk7XG4gICAgICBiYXRjaC51cGRhdGUocG9zdFJlZiwgeyB2b3RlU3RhdHVzOiB2b3RlU3RhdHVzICsgdm90ZUNoYW5nZSB9KTtcbiAgICAgIGF3YWl0IGJhdGNoLmNvbW1pdCgpO1xuICAgIH0gY2F0Y2ggKGVycm9yKSB7XG4gICAgICBjb25zb2xlLmxvZyhcIm9uVm90ZSBlcnJvclwiLCBlcnJvcik7XG4gICAgfVxuICB9O1xuXG4gIGNvbnN0IG9uRGVsZXRlUG9zdCA9IGFzeW5jIChwb3N0OiBQb3N0KTogUHJvbWlzZTxib29sZWFuPiA9PiB7XG4gICAgY29uc29sZS5sb2coXCJERUxFVElORyBQT1NUOiBcIiwgcG9zdC5pZCk7XG5cbiAgICB0cnkge1xuICAgICAgLy8gaWYgcG9zdCBoYXMgYW4gaW1hZ2UgdXJsLCBkZWxldGUgaXQgZnJvbSBzdG9yYWdlXG4gICAgICBpZiAocG9zdC5pbWFnZVVSTCkge1xuICAgICAgICBjb25zdCBpbWFnZVJlZiA9IHJlZihzdG9yYWdlLCBgcG9zdHMvJHtwb3N0LmlkfS9pbWFnZWApO1xuICAgICAgICBhd2FpdCBkZWxldGVPYmplY3QoaW1hZ2VSZWYpO1xuICAgICAgfVxuXG4gICAgICAvLyBkZWxldGUgcG9zdCBmcm9tIHBvc3RzIGNvbGxlY3Rpb25cbiAgICAgIGNvbnN0IHBvc3REb2NSZWYgPSBkb2MoZmlyZXN0b3JlLCBcInBvc3RzXCIsIHBvc3QuaWQpO1xuICAgICAgYXdhaXQgZGVsZXRlRG9jKHBvc3REb2NSZWYpO1xuXG4gICAgICAvLyBVcGRhdGUgcG9zdCBzdGF0ZVxuICAgICAgc2V0UG9zdFN0YXRlVmFsdWUoKHByZXYpID0+ICh7XG4gICAgICAgIC4uLnByZXYsXG4gICAgICAgIHBvc3RzOiBwcmV2LnBvc3RzLmZpbHRlcigoaXRlbSkgPT4gaXRlbS5pZCAhPT0gcG9zdC5pZCksXG4gICAgICAgIC8vIHBvc3RzQ2FjaGU6IHtcbiAgICAgICAgLy8gICAuLi5wcmV2LnBvc3RzQ2FjaGUsXG4gICAgICAgIC8vICAgW3Bvc3QuY29tbXVuaXR5SWRdOiBwcmV2LnBvc3RzQ2FjaGVbcG9zdC5jb21tdW5pdHlJZF0/LmZpbHRlcihcbiAgICAgICAgLy8gICAgIChpdGVtKSA9PiBpdGVtLmlkICE9PSBwb3N0LmlkXG4gICAgICAgIC8vICAgKSxcbiAgICAgICAgLy8gfSxcbiAgICAgIH0pKTtcblxuICAgICAgLyoqXG4gICAgICAgKiBDbG91ZCBGdW5jdGlvbiB3aWxsIHRyaWdnZXIgb24gcG9zdCBkZWxldGVcbiAgICAgICAqIHRvIGRlbGV0ZSBhbGwgY29tbWVudHMgd2l0aCBwb3N0SWQgPT09IHBvc3QuaWRcbiAgICAgICAqL1xuICAgICAgcmV0dXJuIHRydWU7XG4gICAgfSBjYXRjaCAoZXJyb3IpIHtcbiAgICAgIGNvbnNvbGUubG9nKFwiVEhFUkUgV0FTIEFOIEVSUk9SXCIsIGVycm9yKTtcbiAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG4gIH07XG5cbiAgY29uc3QgZ2V0Q29tbXVuaXR5UG9zdFZvdGVzID0gYXN5bmMgKGNvbW11bml0eUlkOiBzdHJpbmcpID0+IHtcbiAgICBjb25zdCBwb3N0Vm90ZXNRdWVyeSA9IHF1ZXJ5KFxuICAgICAgY29sbGVjdGlvbihmaXJlc3RvcmUsIGB1c2Vycy8ke3VzZXI/LnVpZH0vcG9zdFZvdGVzYCksXG4gICAgICB3aGVyZShcImNvbW11bml0eUlkXCIsIFwiPT1cIiwgY29tbXVuaXR5SWQpXG4gICAgKTtcbiAgICBjb25zdCBwb3N0Vm90ZURvY3MgPSBhd2FpdCBnZXREb2NzKHBvc3RWb3Rlc1F1ZXJ5KTtcbiAgICBjb25zdCBwb3N0Vm90ZXMgPSBwb3N0Vm90ZURvY3MuZG9jcy5tYXAoKGRvYykgPT4gKHtcbiAgICAgIGlkOiBkb2MuaWQsXG4gICAgICAuLi5kb2MuZGF0YSgpLFxuICAgIH0pKTtcbiAgICBzZXRQb3N0U3RhdGVWYWx1ZSgocHJldikgPT4gKHtcbiAgICAgIC4uLnByZXYsXG4gICAgICBwb3N0Vm90ZXM6IHBvc3RWb3RlcyBhcyBQb3N0Vm90ZVtdLFxuICAgIH0pKTtcblxuICAgIC8vIGNvbnN0IHVuc3Vic2NyaWJlID0gb25TbmFwc2hvdChwb3N0Vm90ZXNRdWVyeSwgKHF1ZXJ5U25hcHNob3QpID0+IHtcbiAgICAvLyAgIGNvbnN0IHBvc3RWb3RlcyA9IHF1ZXJ5U25hcHNob3QuZG9jcy5tYXAoKHBvc3RWb3RlKSA9PiAoe1xuICAgIC8vICAgICBpZDogcG9zdFZvdGUuaWQsXG4gICAgLy8gICAgIC4uLnBvc3RWb3RlLmRhdGEoKSxcbiAgICAvLyAgIH0pKTtcblxuICAgIC8vIH0pO1xuXG4gICAgLy8gcmV0dXJuICgpID0+IHVuc3Vic2NyaWJlKCk7XG4gIH07XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICBpZiAoIXVzZXI/LnVpZCB8fCAhY29tbXVuaXR5U3RhdGVWYWx1ZS5jdXJyZW50Q29tbXVuaXR5KSByZXR1cm47XG4gICAgZ2V0Q29tbXVuaXR5UG9zdFZvdGVzKGNvbW11bml0eVN0YXRlVmFsdWUuY3VycmVudENvbW11bml0eS5pZCk7XG4gIH0sIFt1c2VyLCBjb21tdW5pdHlTdGF0ZVZhbHVlLmN1cnJlbnRDb21tdW5pdHldKTtcblxuICAvKipcbiAgICogRE8gVEhJUyBJTklUSUFMTFkgRk9SIFBPU1QgVk9URVNcbiAgICovXG4gIC8vIHVzZUVmZmVjdCgoKSA9PiB7XG4gIC8vICAgaWYgKCF1c2VyPy51aWQgfHwgIWNvbW11bml0eURhdGEpIHJldHVybjtcbiAgLy8gICBjb25zdCBwb3N0Vm90ZXNRdWVyeSA9IHF1ZXJ5KFxuICAvLyAgICAgY29sbGVjdGlvbihmaXJlc3RvcmUsIGB1c2Vycy8ke3VzZXI/LnVpZH0vcG9zdFZvdGVzYCksXG4gIC8vICAgICB3aGVyZShcImNvbW11bml0eUlkXCIsIFwiPT1cIiwgY29tbXVuaXR5RGF0YT8uaWQpXG4gIC8vICAgKTtcbiAgLy8gICBjb25zdCB1bnN1YnNjcmliZSA9IG9uU25hcHNob3QocG9zdFZvdGVzUXVlcnksIChxdWVyeVNuYXBzaG90KSA9PiB7XG4gIC8vICAgICBjb25zdCBwb3N0Vm90ZXMgPSBxdWVyeVNuYXBzaG90LmRvY3MubWFwKChwb3N0Vm90ZSkgPT4gKHtcbiAgLy8gICAgICAgaWQ6IHBvc3RWb3RlLmlkLFxuICAvLyAgICAgICAuLi5wb3N0Vm90ZS5kYXRhKCksXG4gIC8vICAgICB9KSk7XG5cbiAgLy8gICAgIHNldFBvc3RTdGF0ZVZhbHVlKChwcmV2KSA9PiAoe1xuICAvLyAgICAgICAuLi5wcmV2LFxuICAvLyAgICAgICBwb3N0Vm90ZXM6IHBvc3RWb3RlcyBhcyBQb3N0Vm90ZVtdLFxuICAvLyAgICAgfSkpO1xuICAvLyAgIH0pO1xuXG4gIC8vICAgcmV0dXJuICgpID0+IHVuc3Vic2NyaWJlKCk7XG4gIC8vIH0sIFt1c2VyLCBjb21tdW5pdHlEYXRhXSk7XG5cbiAgdXNlRWZmZWN0KCgpID0+IHtcbiAgICAvLyBMb2dvdXQgb3Igbm8gYXV0aGVudGljYXRlZCB1c2VyXG4gICAgaWYgKCF1c2VyPy51aWQgJiYgIWxvYWRpbmdVc2VyKSB7XG4gICAgICBzZXRQb3N0U3RhdGVWYWx1ZSgocHJldikgPT4gKHtcbiAgICAgICAgLi4ucHJldixcbiAgICAgICAgcG9zdFZvdGVzOiBbXSxcbiAgICAgIH0pKTtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gIH0sIFt1c2VyLCBsb2FkaW5nVXNlcl0pO1xuXG4gIHJldHVybiB7XG4gICAgcG9zdFN0YXRlVmFsdWUsXG4gICAgc2V0UG9zdFN0YXRlVmFsdWUsXG4gICAgb25TZWxlY3RQb3N0LFxuICAgIG9uRGVsZXRlUG9zdCxcbiAgICBsb2FkaW5nLFxuICAgIHNldExvYWRpbmcsXG4gICAgb25Wb3RlLFxuICAgIGVycm9yLFxuICB9O1xufTtcblxuZXhwb3J0IGRlZmF1bHQgdXNlUG9zdHM7Il0sIm5hbWVzIjpbIlJlYWN0IiwidXNlRWZmZWN0IiwidXNlU3RhdGUiLCJjb2xsZWN0aW9uIiwiZGVsZXRlRG9jIiwiZG9jIiwiZ2V0RG9jcyIsInF1ZXJ5Iiwid2hlcmUiLCJ3cml0ZUJhdGNoIiwiZGVsZXRlT2JqZWN0IiwicmVmIiwidXNlQXV0aFN0YXRlIiwidXNlUmVjb2lsU3RhdGUiLCJ1c2VSZWNvaWxWYWx1ZSIsInVzZVNldFJlY29pbFN0YXRlIiwiYXV0aE1vZGFsU3RhdGUiLCJjb21tdW5pdHlTdGF0ZSIsInBvc3RTdGF0ZSIsImF1dGgiLCJmaXJlc3RvcmUiLCJzdG9yYWdlIiwidXNlUm91dGVyIiwidXNlUG9zdHMiLCJjb21tdW5pdHlEYXRhIiwidXNlciIsImxvYWRpbmdVc2VyIiwicG9zdFN0YXRlVmFsdWUiLCJzZXRQb3N0U3RhdGVWYWx1ZSIsInNldEF1dGhNb2RhbFN0YXRlIiwibG9hZGluZyIsInNldExvYWRpbmciLCJlcnJvciIsInNldEVycm9yIiwicm91dGVyIiwiY29tbXVuaXR5U3RhdGVWYWx1ZSIsIm9uU2VsZWN0UG9zdCIsInBvc3QiLCJwb3N0SWR4IiwiY29uc29sZSIsImxvZyIsInByZXYiLCJzZWxlY3RlZFBvc3QiLCJwdXNoIiwiY29tbXVuaXR5SWQiLCJpZCIsIm9uVm90ZSIsImV2ZW50Iiwidm90ZSIsInN0b3BQcm9wYWdhdGlvbiIsInVpZCIsIm9wZW4iLCJ2aWV3Iiwidm90ZVN0YXR1cyIsImV4aXN0aW5nVm90ZSIsInBvc3RWb3RlcyIsImZpbmQiLCJwb3N0SWQiLCJ2b3RlQ2hhbmdlIiwiYmF0Y2giLCJ1cGRhdGVkUG9zdCIsInVwZGF0ZWRQb3N0cyIsInBvc3RzIiwidXBkYXRlZFBvc3RWb3RlcyIsInBvc3RWb3RlUmVmIiwibmV3Vm90ZSIsInZvdGVWYWx1ZSIsInNldCIsImZpbHRlciIsImRlbGV0ZSIsInZvdGVJZHgiLCJmaW5kSW5kZXgiLCJ1cGRhdGUiLCJ1cGRhdGVkU3RhdGUiLCJpdGVtIiwicG9zdFJlZiIsImNvbW1pdCIsIm9uRGVsZXRlUG9zdCIsImltYWdlVVJMIiwiaW1hZ2VSZWYiLCJwb3N0RG9jUmVmIiwiZ2V0Q29tbXVuaXR5UG9zdFZvdGVzIiwicG9zdFZvdGVzUXVlcnkiLCJwb3N0Vm90ZURvY3MiLCJkb2NzIiwibWFwIiwiZGF0YSIsImN1cnJlbnRDb21tdW5pdHkiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///./src/hooks/usePosts.tsx\n"));

/***/ })

});